# DDNet 玩家追踪器测试用例

## 1. 通知功能测试

### 1.1 基础通知逻辑
- **测试用例**: 离线玩家不应触发上线通知
- **前置条件**: 玩家在追踪列表中，通知已开启
- **操作**: 搜索返回 `isOnline: false` 的玩家
- **预期结果**: 不发送通知

- **测试用例**: 在线玩家状态变化触发通知
- **前置条件**: 玩家在追踪列表中，通知已开启，玩家之前离线
- **操作**: 搜索返回 `isOnline: true` 的玩家
- **预期结果**: 发送上线通知

### 1.2 个人通知设置
- **测试用例**: 关闭个人通知的玩家不触发通知
- **前置条件**: 玩家 `notificationEnabled: false`
- **操作**: 玩家从离线变为在线
- **预期结果**: 不发送通知

- **测试用例**: 开启个人通知的玩家触发通知
- **前置条件**: 玩家 `notificationEnabled: true`
- **操作**: 玩家从离线变为在线
- **预期结果**: 发送通知

### 1.3 首次加载和激活场景
- **测试用例**: 应用首次启动不误报通知
- **前置条件**: 应用刚启动，`isInitialLoad: true`
- **操作**: 首次搜索返回在线玩家
- **预期结果**: 不发送通知，`isInitialLoad` 设为 `false`

- **测试用例**: 空列表激活在线玩家触发通知
- **前置条件**: 激活列表为空，`previousResults: []`，`isInitialLoad: false`
- **操作**: 激活一个在线玩家并搜索
- **预期结果**: 发送上线通知

- **测试用例**: 非空列表激活新玩家触发通知
- **前置条件**: 激活列表不为空，`isInitialLoad: false`
- **操作**: 激活一个新的在线玩家并搜索
- **预期结果**: 发送上线通知

## 2. 状态管理测试

### 2.1 追踪状态切换
- **测试用例**: 激活玩家追踪
- **操作**: 点击"未追踪"按钮切换为"已追踪"
- **预期结果**: `isActive: true`，UI状态更新

- **测试用例**: 停用玩家追踪
- **操作**: 点击"已追踪"按钮切换为"未追踪"
- **预期结果**: `isActive: false`，玩家从搜索结果中移除

### 2.2 通知状态切换
- **测试用例**: 开启玩家通知
- **操作**: 点击"通知关"按钮切换为"通知开"
- **预期结果**: `notificationEnabled: true`，UI状态更新

- **测试用例**: 关闭玩家通知
- **操作**: 点击"通知开"按钮切换为"通知关"
- **预期结果**: `notificationEnabled: false`，UI状态更新

## 3. 批量操作测试

### 3.1 批量选择功能
- **测试用例**: 点击列表项左侧区域选中玩家
- **操作**: 点击包含checkbox和玩家名的左侧区域
- **预期结果**: 玩家被选中，checkbox状态更新

- **测试用例**: 全选本页功能
- **操作**: 点击"全选本页"checkbox
- **预期结果**: 当前页所有玩家被选中

### 3.2 批量操作执行
- **测试用例**: 批量激活追踪
- **前置条件**: 选中多个未追踪玩家
- **操作**: 选择"激活追踪"并执行
- **预期结果**: 所有选中玩家的 `isActive` 设为 `true`

- **测试用例**: 批量开启通知
- **前置条件**: 选中多个通知关闭的玩家
- **操作**: 选择"开启通知"并执行
- **预期结果**: 所有选中玩家的 `notificationEnabled` 设为 `true`

- **测试用例**: 批量关闭通知
- **前置条件**: 选中多个通知开启的玩家
- **操作**: 选择"关闭通知"并执行
- **预期结果**: 所有选中玩家的 `notificationEnabled` 设为 `false`

- **测试用例**: 批量删除玩家
- **前置条件**: 选中多个玩家
- **操作**: 选择"删除玩家"并执行
- **预期结果**: 所有选中玩家从列表中移除

### 3.3 批量操作UI状态
- **测试用例**: 批量操作区域显示位置
- **前置条件**: 选中至少一个玩家
- **操作**: 查看UI布局
- **预期结果**: 批量操作区域显示在玩家列表下方

- **测试用例**: 批量操作完成后状态更新
- **操作**: 执行任意批量操作
- **预期结果**: 操作完成后，前端列表状态立即更新，选中状态清除

## 4. 筛选功能测试

### 4.1 状态筛选
- **测试用例**: 筛选已追踪玩家
- **操作**: 选择"已追踪"筛选选项
- **预期结果**: 只显示 `isActive: true` 的玩家

- **测试用例**: 筛选未追踪玩家
- **操作**: 选择"未追踪"筛选选项
- **预期结果**: 只显示 `isActive: false` 的玩家

- **测试用例**: 筛选通知开启玩家
- **操作**: 选择"通知开启"筛选选项
- **预期结果**: 只显示 `notificationEnabled: true` 的玩家

- **测试用例**: 筛选通知关闭玩家
- **操作**: 选择"通知关闭"筛选选项
- **预期结果**: 只显示 `notificationEnabled: false` 的玩家

## 5. UI交互测试

### 5.1 立即刷新功能
- **测试用例**: 立即刷新冷却时间
- **操作**: 点击"立即刷新"按钮
- **预期结果**: 按钮被禁用5秒，期间无法再次点击

- **测试用例**: 冷却期间按钮状态
- **操作**: 在冷却期间查看按钮
- **预期结果**: 按钮显示"立即刷新"但被禁用，不显示倒计时文本

### 5.2 复制功能
- **测试用例**: 点击复制服务器地址
- **前置条件**: 玩家在线且有服务器地址
- **操作**: 点击玩家卡片
- **预期结果**: 服务器地址被复制到剪贴板，显示"已复制!"文本替换"点击复制"

- **测试用例**: 复制状态重置
- **操作**: 复制成功后等待2秒
- **预期结果**: "已复制!"文本恢复为"点击复制"

## 6. 搜索不触发场景测试

### 6.1 状态变更不触发搜索
- **测试用例**: 切换追踪状态不触发搜索
- **操作**: 切换玩家的追踪状态
- **预期结果**: 只更新本地状态，不发送搜索请求

- **测试用例**: 切换通知状态不触发搜索
- **操作**: 切换玩家的通知状态
- **预期结果**: 只更新本地状态，不发送搜索请求

- **测试用例**: 删除玩家不触发搜索
- **操作**: 删除一个玩家
- **预期结果**: 只更新本地列表，不发送搜索请求

- **测试用例**: 编辑玩家名不触发搜索
- **操作**: 修改玩家名并保存
- **预期结果**: 只更新本地数据，不发送搜索请求

## 7. 边界条件测试

### 7.1 空状态处理
- **测试用例**: 无追踪玩家时的显示
- **前置条件**: 追踪列表为空
- **预期结果**: 显示"开始追踪玩家"的引导信息

- **测试用例**: 所有玩家离线时的显示
- **前置条件**: 有追踪玩家但全部离线
- **预期结果**: 显示"所有玩家都离线了"的信息

### 7.2 网络错误处理
- **测试用例**: API请求失败时的处理
- **操作**: 模拟网络错误
- **预期结果**: 显示错误信息，不影响现有数据显示

- **测试用例**: 搜索请求超时处理
- **操作**: 模拟请求超时
- **预期结果**: 停止loading状态，显示错误提示

## 测试数据结构

### 玩家数据模板
```typescript
interface TrackedPlayer {
  id: string;
  playerName: string;
  isActive: boolean;
  notificationEnabled: boolean;
  createdAt: Date;
}

interface PlayerItem {
  player: string;
  server?: string;
  serverAddr?: string;
  map?: string;
  location?: string;
  score?: number;
  skin?: string;
  team?: number;
  afk?: string;
  isOnline?: boolean;
}
```

### 测试场景数据
```javascript
// 测试用玩家数据
const mockPlayers = [
  { id: "1", playerName: "TestPlayer1", isActive: true, notificationEnabled: true },
  { id: "2", playerName: "TestPlayer2", isActive: false, notificationEnabled: true },
  { id: "3", playerName: "TestPlayer3", isActive: true, notificationEnabled: false },
];

// 在线玩家响应
const onlinePlayerResponse = {
  player: "TestPlayer1",
  server: "Test Server",
  serverAddr: "127.0.0.1:8303",
  map: "Test Map",
  isOnline: true
};

// 离线玩家响应
const offlinePlayerResponse = {
  player: "TestPlayer2",
  isOnline: false,
  server: "离线"
};
```